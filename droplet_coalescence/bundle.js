(()=>{"use strict";class t{constructor(t,e=0){this.bounds={x:t.x||0,y:t.y||0,width:t.width,height:t.height},this.maxObjects="number"==typeof t.maxObjects?t.maxObjects:10,this.maxLevels="number"==typeof t.maxLevels?t.maxLevels:4,this.level=e,this.objects=[],this.nodes=[]}getIndex(t){return t.qtIndex(this.bounds)}split(){const e=this.level+1,s=this.bounds.width/2,i=this.bounds.height/2,h=this.bounds.x,r=this.bounds.y,n=[{x:h+s,y:r},{x:h,y:r},{x:h,y:r+i},{x:h+s,y:r+i}];for(let h=0;h<4;h++)this.nodes[h]=new t({x:n[h].x,y:n[h].y,width:s,height:i,maxObjects:this.maxObjects,maxLevels:this.maxLevels},e)}insert(t){if(this.nodes.length){const e=this.getIndex(t);for(let s=0;s<e.length;s++)this.nodes[e[s]].insert(t);return}if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels){this.nodes.length||this.split();for(let t=0;t<this.objects.length;t++){const e=this.getIndex(this.objects[t]);for(let s=0;s<e.length;s++)this.nodes[e[s]].insert(this.objects[t])}this.objects=[]}}retrieve(t){const e=this.getIndex(t);let s=this.objects;if(this.nodes.length)for(let i=0;i<e.length;i++)s=s.concat(this.nodes[e[i]].retrieve(t));return 0===this.level?Array.from(new Set(s)):s}remove(t,e=!1){const s=this.objects.indexOf(t);s>-1&&this.objects.splice(s,1);for(let e=0;e<this.nodes.length;e++)this.nodes[e].remove(t);return 0!==this.level||e||this.join(),-1!==s}update(t,e=!1){this.remove(t,e),this.insert(t)}join(){let t=Array.from(this.objects);for(let e=0;e<this.nodes.length;e++){const s=this.nodes[e].join();t=t.concat(s)}const e=Array.from(new Set(t));if(e.length<=this.maxObjects){this.objects=e;for(let t=0;t<this.nodes.length;t++)this.nodes[t].objects=[];this.nodes=[]}return t}clear(){this.objects=[];for(let t=0;t<this.nodes.length;t++)this.nodes.length&&this.nodes[t].clear();this.nodes=[]}}class e{constructor(t){this.x=t.x,this.y=t.y,this.r=t.r,this.data=t.data}qtIndex(t){const s=[],i=t.width/2,h=t.height/2,r=t.x+i,n=t.y+h,o=[[r,t.y],[t.x,t.y],[t.x,n],[r,n]];for(let t=0;t<o.length;t++)e.intersectRect(this.x,this.y,this.r,o[t][0],o[t][1],o[t][0]+i,o[t][1]+h)&&s.push(t);return s}static intersectRect(t,e,s,i,h,r,n){const o=t-Math.max(i,Math.min(t,r)),a=e-Math.max(h,Math.min(e,n));return o*o+a*a<s*s}}class s{constructor(t,e,s,i){this.x=t,this.y=e,this.area=s,this.id=i}absorb(t){const e=this.area+t.area;this.x=(this.x*this.area+t.x*t.area)/e,this.y=(this.y*this.area+t.y*t.area)/e,this.area=e}radius(){return Math.sqrt(this.area/Math.PI)}qtIndex(t){return e.prototype.qtIndex.call({x:this.x,y:this.y,r:this.radius()},t)}}function i(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}class h{constructor(e,s,i,h){this.width=e,this.height=s,this.n_samples=i,this.sample_droplet_area=h,this.cur_id=0,this.quadtree=new t({width:e,height:s,maxObjects:4,maxLevels:6}),this.largest_droplet_area=0}addDroplet(t){for(;;){let e=this.quadtree.retrieve(t),s=null;for(const h of e)if(i(t,h)<=t.radius()+h.radius()){this.quadtree.remove(h,!0),h.absorb(t),s=h;break}if(!s)break;t=s}t.area>this.largest_droplet_area&&(this.largest_droplet_area=t.area),this.quadtree.insert(t)}droplets(){return this.quadtree.retrieve(new s(this.width/2,this.height/2,1e10,0))}step(){for(var t=0;t<this.n_samples;++t)this.addDroplet(new s(Math.random()*this.width,Math.random()*this.height,this.sample_droplet_area,++this.cur_id))}draw(t){const e=this.droplets();for(const s of e)t.fillStyle="rgb(200 0 0)",t.beginPath(),t.arc(s.x,s.y,s.radius(),0,2*Math.PI),t.fill()}}window.addEventListener("load",function(){return t=this,e=void 0,i=function*(){const t=document.getElementById("canvas"),e=t.getContext("2d"),s=new h(t.width,t.height,500,250);if(!e)throw new Error("unsupported 2d canvas");for(;s.largest_droplet_area<t.width*t.height/4;){if(s.step(),e.clearRect(0,0,t.width,t.height),s.draw(e),1==s.droplets.length)return;yield new Promise(t=>setTimeout(t,30))}},new((s=void 0)||(s=Promise))(function(h,r){function n(t){try{a(i.next(t))}catch(t){r(t)}}function o(t){try{a(i.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?h(t.value):(e=t.value,e instanceof s?e:new s(function(t){t(e)})).then(n,o)}a((i=i.apply(t,e||[])).next())});var t,e,s,i})})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU90RixNQUFRc0YsRUFBT3JGLE9BQVMsR0FBRyxDQUl2RSxHQUhBeUYsRUFBV2YsT0FDWEcsRUFBSWMsVUFBVSxFQUFHLEVBQUdOLEVBQU90RixNQUFPc0YsRUFBT3JGLFFBQ3pDeUYsRUFBV2IsS0FBS0MsR0FDa0IsR0FBOUJZLEVBQVdoQixTQUFTN0QsT0FDcEIsYUFFRSxJQUFJZ0YsUUFBUUMsR0FBV0MsV0FBV0QsRUFBUyxJQUNyRCxDQUNKLEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9kcm9wbGV0LWNvYWxlc2NlbmNlLy4vbm9kZV9tb2R1bGVzL0B0aW1vaGF1c21hbm4vcXVhZHRyZWUtdHMvZGlzdC9xdWFkdHJlZS5lc20uanMiLCJ3ZWJwYWNrOi8vZHJvcGxldC1jb2FsZXNjZW5jZS8uL3NyYy9zaW11bGF0aW9uLnRzIiwid2VicGFjazovL2Ryb3BsZXQtY29hbGVzY2VuY2UvLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDbGFzcyByZXByZXNlbnRpbmcgYSBRdWFkdHJlZSBub2RlLlxuICpcbiAqIEBleGFtcGxlXG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBjb25zdCB0cmVlID0gbmV3IFF1YWR0cmVlKHtcbiAqICAgd2lkdGg6IDEwMCxcbiAqICAgaGVpZ2h0OiAxMDAsXG4gKiAgIHg6IDAsICAgICAgICAgICAvLyBvcHRpb25hbCwgZGVmYXVsdDogIDBcbiAqICAgeTogMCwgICAgICAgICAgIC8vIG9wdGlvbmFsLCBkZWZhdWx0OiAgMFxuICogICBtYXhPYmplY3RzOiAxMCwgLy8gb3B0aW9uYWwsIGRlZmF1bHQ6IDEwXG4gKiAgIG1heExldmVsczogNCwgICAvLyBvcHRpb25hbCwgZGVmYXVsdDogIDRcbiAqIH0pO1xuICogYGBgXG4gKlxuICogQGV4YW1wbGUgVHlwZXNjcmlwdDogSWYgeW91IGxpa2UgdG8gYmUgZXhwbGljaXQsIHlvdSBvcHRpb25hbGx5IGNhbiBwYXNzIGluIGEgZ2VuZXJpYyB0eXBlIGZvciBvYmplY3RzIHRvIGJlIHN0b3JlZCBpbiB0aGUgUXVhZHRyZWU6XG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBjbGFzcyBHYW1lRW50aXR5IGV4dGVuZHMgUmVjdGFuZ2xlIHtcbiAqICAgLi4uXG4gKiB9XG4gKiBjb25zdCB0cmVlID0gbmV3IFF1YWR0cmVlPEdhbWVFbnRpdHk+KHtcbiAqICAgd2lkdGg6IDEwMCxcbiAqICAgaGVpZ2h0OiAxMDAsXG4gKiB9KTtcbiAqIGBgYFxuICovXG5jbGFzcyBRdWFkdHJlZSB7XG4gICAgLyoqXG4gICAgICogUXVhZHRyZWUgQ29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0gcHJvcHMgLSBib3VuZHMgYW5kIHByb3BlcnRpZXMgb2YgdGhlIG5vZGVcbiAgICAgKiBAcGFyYW0gbGV2ZWwgLSBkZXB0aCBsZXZlbCAoaW50ZXJuYWwgdXNlIG9ubHksIHJlcXVpcmVkIGZvciBzdWJub2RlcylcbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihwcm9wcywgbGV2ZWwgPSAwKSB7XG4gICAgICAgIHRoaXMuYm91bmRzID0ge1xuICAgICAgICAgICAgeDogcHJvcHMueCB8fCAwLFxuICAgICAgICAgICAgeTogcHJvcHMueSB8fCAwLFxuICAgICAgICAgICAgd2lkdGg6IHByb3BzLndpZHRoLFxuICAgICAgICAgICAgaGVpZ2h0OiBwcm9wcy5oZWlnaHQsXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubWF4T2JqZWN0cyA9ICh0eXBlb2YgcHJvcHMubWF4T2JqZWN0cyA9PT0gJ251bWJlcicpID8gcHJvcHMubWF4T2JqZWN0cyA6IDEwO1xuICAgICAgICB0aGlzLm1heExldmVscyA9ICh0eXBlb2YgcHJvcHMubWF4TGV2ZWxzID09PSAnbnVtYmVyJykgPyBwcm9wcy5tYXhMZXZlbHMgOiA0O1xuICAgICAgICB0aGlzLmxldmVsID0gbGV2ZWw7XG4gICAgICAgIHRoaXMub2JqZWN0cyA9IFtdO1xuICAgICAgICB0aGlzLm5vZGVzID0gW107XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEdldCB0aGUgcXVhZHJhbnQgKHN1Ym5vZGUgaW5kZXhlcykgYW4gb2JqZWN0IGJlbG9uZ3MgdG8uXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZSBNb3N0bHkgZm9yIGludGVybmFsIHVzZSBidXQgeW91IGNhbiBjYWxsIGl0IGxpa2Ugc286XG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvbnN0IHRyZWUgPSBuZXcgUXVhZHRyZWUoeyB3aWR0aDogMTAwLCBoZWlnaHQ6IDEwMCB9KTtcbiAgICAgKiBjb25zdCByZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKHsgeDogMjUsIHk6IDI1LCB3aWR0aDogMTAsIGhlaWdodDogMTAgfSk7XG4gICAgICogY29uc3QgaW5kZXhlcyA9IHRyZWUuZ2V0SW5kZXgocmVjdGFuZ2xlKTtcbiAgICAgKiBjb25zb2xlLmxvZyhpbmRleGVzKTsgLy8gWzFdXG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb2JqIC0gb2JqZWN0IHRvIGJlIGNoZWNrZWRcbiAgICAgKiBAcmV0dXJucyBBcnJheSBjb250YWluaW5nIGluZGV4ZXMgb2YgaW50ZXJzZWN0aW5nIHN1Ym5vZGVzICgwLTMgPSB0b3AtcmlnaHQsIHRvcC1sZWZ0LCBib3R0b20tbGVmdCwgYm90dG9tLXJpZ2h0KS5cbiAgICAgKi9cbiAgICBnZXRJbmRleChvYmopIHtcbiAgICAgICAgcmV0dXJuIG9iai5xdEluZGV4KHRoaXMuYm91bmRzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU3BsaXQgdGhlIG5vZGUgaW50byA0IHN1Ym5vZGVzLlxuICAgICAqIEBpbnRlcm5hbCBNb3N0bHkgZm9yIGludGVybmFsIHVzZSEgWW91IHNob3VsZCBvbmx5IGNhbGwgdGhpcyB5b3Vyc2VsZiBpZiB5b3Uga25vdyB3aGF0IHlvdSBhcmUgZG9pbmcuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZSBNYW51YWwgc3BsaXQ6XG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvbnN0IHRyZWUgPSBuZXcgUXVhZHRyZWUoeyB3aWR0aDogMTAwLCBoZWlnaHQ6IDEwMCB9KTtcbiAgICAgKiB0cmVlLnNwbGl0KCk7XG4gICAgICogY29uc29sZS5sb2codHJlZSk7IC8vIG5vdyB0cmVlIGhhcyBmb3VyIHN1Ym5vZGVzXG4gICAgICogYGBgXG4gICAgICovXG4gICAgc3BsaXQoKSB7XG4gICAgICAgIGNvbnN0IGxldmVsID0gdGhpcy5sZXZlbCArIDEsIHdpZHRoID0gdGhpcy5ib3VuZHMud2lkdGggLyAyLCBoZWlnaHQgPSB0aGlzLmJvdW5kcy5oZWlnaHQgLyAyLCB4ID0gdGhpcy5ib3VuZHMueCwgeSA9IHRoaXMuYm91bmRzLnk7XG4gICAgICAgIGNvbnN0IGNvb3JkcyA9IFtcbiAgICAgICAgICAgIHsgeDogeCArIHdpZHRoLCB5OiB5IH0sXG4gICAgICAgICAgICB7IHg6IHgsIHk6IHkgfSxcbiAgICAgICAgICAgIHsgeDogeCwgeTogeSArIGhlaWdodCB9LFxuICAgICAgICAgICAgeyB4OiB4ICsgd2lkdGgsIHk6IHkgKyBoZWlnaHQgfSxcbiAgICAgICAgXTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA0OyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMubm9kZXNbaV0gPSBuZXcgUXVhZHRyZWUoe1xuICAgICAgICAgICAgICAgIHg6IGNvb3Jkc1tpXS54LFxuICAgICAgICAgICAgICAgIHk6IGNvb3Jkc1tpXS55LFxuICAgICAgICAgICAgICAgIHdpZHRoLFxuICAgICAgICAgICAgICAgIGhlaWdodCxcbiAgICAgICAgICAgICAgICBtYXhPYmplY3RzOiB0aGlzLm1heE9iamVjdHMsXG4gICAgICAgICAgICAgICAgbWF4TGV2ZWxzOiB0aGlzLm1heExldmVscyxcbiAgICAgICAgICAgIH0sIGxldmVsKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBJbnNlcnQgYW4gb2JqZWN0IGludG8gdGhlIG5vZGUuIElmIHRoZSBub2RlXG4gICAgICogZXhjZWVkcyB0aGUgY2FwYWNpdHksIGl0IHdpbGwgc3BsaXQgYW5kIGFkZCBhbGxcbiAgICAgKiBvYmplY3RzIHRvIHRoZWlyIGNvcnJlc3BvbmRpbmcgc3Vibm9kZXMuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZSB5b3UgY2FuIHVzZSBhbnkgc2hhcGUgaGVyZSAob3Igb2JqZWN0IHdpdGggYSBxdEluZGV4IG1ldGhvZCwgc2VlIFJFQURNRSk6XG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvbnN0IHRyZWUgPSBuZXcgUXVhZHRyZWUoeyB3aWR0aDogMTAwLCBoZWlnaHQ6IDEwMCB9KTtcbiAgICAgKiB0cmVlLmluc2VydChuZXcgUmVjdGFuZ2xlKHsgeDogMjUsIHk6IDI1LCB3aWR0aDogMTAsIGhlaWdodDogMTAsIGRhdGE6ICdkYXRhJyB9KSk7XG4gICAgICogdHJlZS5pbnNlcnQobmV3IENpcmNsZSh7IHg6IDI1LCB5OiAyNSwgcjogMTAsIGRhdGE6IDUxMiB9KSk7XG4gICAgICogdHJlZS5pbnNlcnQobmV3IExpbmUoeyB4MTogMjUsIHkxOiAyNSwgeDI6IDYwLCB5MjogNDAsIGRhdGE6IHsgY3VzdG9tOiAncHJvcGVydHknfSB9KSk7XG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb2JqIC0gT2JqZWN0IHRvIGJlIGFkZGVkLlxuICAgICAqL1xuICAgIGluc2VydChvYmopIHtcbiAgICAgICAgLy9pZiB3ZSBoYXZlIHN1Ym5vZGVzLCBjYWxsIGluc2VydCBvbiBtYXRjaGluZyBzdWJub2Rlc1xuICAgICAgICBpZiAodGhpcy5ub2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGNvbnN0IGluZGV4ZXMgPSB0aGlzLmdldEluZGV4KG9iaik7XG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGluZGV4ZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGVzW2luZGV4ZXNbaV1dLmluc2VydChvYmopO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vb3RoZXJ3aXNlLCBzdG9yZSBvYmplY3QgaGVyZVxuICAgICAgICB0aGlzLm9iamVjdHMucHVzaChvYmopO1xuICAgICAgICAvL21heE9iamVjdHMgcmVhY2hlZFxuICAgICAgICBpZiAodGhpcy5vYmplY3RzLmxlbmd0aCA+IHRoaXMubWF4T2JqZWN0cyAmJiB0aGlzLmxldmVsIDwgdGhpcy5tYXhMZXZlbHMpIHtcbiAgICAgICAgICAgIC8vc3BsaXQgaWYgd2UgZG9uJ3QgYWxyZWFkeSBoYXZlIHN1Ym5vZGVzXG4gICAgICAgICAgICBpZiAoIXRoaXMubm9kZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGxpdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9hZGQgYWxsIG9iamVjdHMgdG8gdGhlaXIgY29ycmVzcG9uZGluZyBzdWJub2RlXG4gICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMub2JqZWN0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGNvbnN0IGluZGV4ZXMgPSB0aGlzLmdldEluZGV4KHRoaXMub2JqZWN0c1tpXSk7XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBpbmRleGVzLmxlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubm9kZXNbaW5kZXhlc1trXV0uaW5zZXJ0KHRoaXMub2JqZWN0c1tpXSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9jbGVhbiB1cCB0aGlzIG5vZGVcbiAgICAgICAgICAgIHRoaXMub2JqZWN0cyA9IFtdO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFJldHVybiBhbGwgb2JqZWN0cyB0aGF0IGNvdWxkIGNvbGxpZGUgd2l0aCB0aGUgZ2l2ZW4gZ2VvbWV0cnkuXG4gICAgICpcbiAgICAgKiBAZXhhbXBsZSBKdXN0IGxpa2UgaW5zZXJ0LCB5b3UgY2FuIHVzZSBhbnkgc2hhcGUgaGVyZSAob3Igb2JqZWN0IHdpdGggYSBxdEluZGV4IG1ldGhvZCwgc2VlIFJFQURNRSk6XG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIHRyZWUucmV0cmlldmUobmV3IFJlY3RhbmdsZSh7IHg6IDI1LCB5OiAyNSwgd2lkdGg6IDEwLCBoZWlnaHQ6IDEwLCBkYXRhOiAnZGF0YScgfSkpO1xuICAgICAqIHRyZWUucmV0cmlldmUobmV3IENpcmNsZSh7IHg6IDI1LCB5OiAyNSwgcjogMTAsIGRhdGE6IDUxMiB9KSk7XG4gICAgICogdHJlZS5yZXRyaWV2ZShuZXcgTGluZSh7IHgxOiAyNSwgeTE6IDI1LCB4MjogNjAsIHkyOiA0MCwgZGF0YTogeyBjdXN0b206ICdwcm9wZXJ0eSd9IH0pKTtcbiAgICAgKiBgYGBcbiAgICAgKlxuICAgICAqIEBwYXJhbSBvYmogLSBnZW9tZXRyeSB0byBiZSBjaGVja2VkXG4gICAgICogQHJldHVybnMgQXJyYXkgY29udGFpbmluZyBhbGwgZGV0ZWN0ZWQgb2JqZWN0cy5cbiAgICAgKi9cbiAgICByZXRyaWV2ZShvYmopIHtcbiAgICAgICAgY29uc3QgaW5kZXhlcyA9IHRoaXMuZ2V0SW5kZXgob2JqKTtcbiAgICAgICAgbGV0IHJldHVybk9iamVjdHMgPSB0aGlzLm9iamVjdHM7XG4gICAgICAgIC8vaWYgd2UgaGF2ZSBzdWJub2RlcywgcmV0cmlldmUgdGhlaXIgb2JqZWN0c1xuICAgICAgICBpZiAodGhpcy5ub2Rlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgaW5kZXhlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHJldHVybk9iamVjdHMgPSByZXR1cm5PYmplY3RzLmNvbmNhdCh0aGlzLm5vZGVzW2luZGV4ZXNbaV1dLnJldHJpZXZlKG9iaikpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIC8vIHJlbW92ZSBkdXBsaWNhdGVzXG4gICAgICAgIGlmICh0aGlzLmxldmVsID09PSAwKSB7XG4gICAgICAgICAgICByZXR1cm4gQXJyYXkuZnJvbShuZXcgU2V0KHJldHVybk9iamVjdHMpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmV0dXJuT2JqZWN0cztcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlIGFuIG9iamVjdCBmcm9tIHRoZSB0cmVlLlxuICAgICAqIElmIHlvdSBoYXZlIHRvIHJlbW92ZSBtYW55IG9iamVjdHMsIGNvbnNpZGVyIGNsZWFyaW5nIHRoZSBlbnRpcmUgdHJlZSBhbmQgcmVidWlsZGluZyBpdCBvciB1c2UgdGhlIGBmYXN0YCBmbGFnIHRvIGNsZWFudXAgYWZ0ZXIgdGhlIGxhc3QgcmVtb3ZhbC5cbiAgICAgKiBAYmV0YVxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgdHJlZSA9IG5ldyBRdWFkdHJlZSh7IHdpZHRoOiAxMDAsIGhlaWdodDogMTAwIH0pO1xuICAgICAqIGNvbnN0IGNpcmNsZSA9IG5ldyBDaXJjbGUoeyB4OiAyNSwgeTogMjUsIHI6IDEwLCBkYXRhOiA1MTIgfSk7XG4gICAgICogdHJlZS5pbnNlcnQoY2lyY2xlKTtcbiAgICAgKiB0cmVlLnJlbW92ZShjaXJjbGUpO1xuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQGV4YW1wbGUgQnVsayBmYXN0IHJlbW92YWxzIGFuZCBmaW5hbCBjbGVhbnVwOlxuICAgICAqIGBgYGphdmFzY3JpcHRcbiAgICAgKiBjb25zdCB0cmVlID0gbmV3IFF1YWR0cmVlKHsgd2lkdGg6IDEwMCwgaGVpZ2h0OiAxMDAgfSk7XG4gICAgICogY29uc3QgcmVjdHMgPSBbXTtcbiAgICAgKiAgZm9yKGxldCBpPTA7IGk8MjA7IGkrKykge1xuICAgICAqICAgIHJlY3RzW2ldID0gbmV3IFJlY3RhbmdsZSh7IHg6IDI1LCB5OiAyNSwgd2lkdGg6IDUwLCBoZWlnaHQ6IDUwIH0pO1xuICAgICAqICAgIHRyZWUuaW5zZXJ0KHJlY3RzW2ldKTtcbiAgICAgKiAgfVxuICAgICAqICBmb3IobGV0IGk9cmVjdHMubGVuZ3RoLTE7IGk+MDsgaS0tKSB7XG4gICAgICogICAgLy9mYXN0PXRydWUg4oCTIGp1c3QgcmVtb3ZlIHRoZSBvYmplY3QgKG1heSBsZWF2ZXMgdmFjYW50IHN1Ym5vZGVzKVxuICAgICAqICAgIC8vZmFzdD1mYWxzZSDigJMgY2xlYW51cCBlbXB0eSBzdWJub2RlcyAoZGVmYXVsdClcbiAgICAgKiAgICBjb25zdCBmYXN0ID0gKGkgIT09IDApO1xuICAgICAqICAgIHRyZWUucmVtb3ZlKHJlY3RzW2ldLCBmYXN0KTtcbiAgICAgKiAgfVxuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQHBhcmFtIG9iaiAtIE9iamVjdCB0byBiZSByZW1vdmVkLlxuICAgICAqIEBwYXJhbSBmYXN0IC0gU2V0IHRvIHRydWUgdG8gaW5jcmVhc2UgcGVyZm9ybWFuY2UgdGVtcG9yYXJpbHkgYnkgcHJldmVudGluZyBjbGVhbnVwIG9mIGVtcHR5IHN1Ym5vZGVzIChvcHRpb25hbCwgZGVmYXVsdDogZmFsc2UpLlxuICAgICAqIEByZXR1cm5zIFdlYXRoZXIgb3Igbm90IHRoZSBvYmplY3Qgd2FzIHJlbW92ZWQgZnJvbSBUSElTIG5vZGUgKG5vIHJlY3Vyc2l2ZSBjaGVjaykuXG4gICAgICovXG4gICAgcmVtb3ZlKG9iaiwgZmFzdCA9IGZhbHNlKSB7XG4gICAgICAgIGNvbnN0IGluZGV4T2YgPSB0aGlzLm9iamVjdHMuaW5kZXhPZihvYmopO1xuICAgICAgICAvLyByZW1vdmUgb2JqZWN0c1xuICAgICAgICBpZiAoaW5kZXhPZiA+IC0xKSB7XG4gICAgICAgICAgICB0aGlzLm9iamVjdHMuc3BsaWNlKGluZGV4T2YsIDEpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHJlbW92ZSBmcm9tIGFsbCBzdWJub2Rlc1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHRoaXMubm9kZXNbaV0ucmVtb3ZlKG9iaik7XG4gICAgICAgIH1cbiAgICAgICAgLy8gcmVtb3ZlIGFsbCBlbXB0eSBzdWJub2Rlc1xuICAgICAgICBpZiAodGhpcy5sZXZlbCA9PT0gMCAmJiAhZmFzdCkge1xuICAgICAgICAgICAgdGhpcy5qb2luKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIChpbmRleE9mICE9PSAtMSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFVwZGF0ZSBhbiBvYmplY3QgYWxyZWFkeSBpbiB0aGUgdHJlZSAoc2hvcnRoYW5kIGZvciByZW1vdmUgYW5kIGluc2VydCkuXG4gICAgICogSWYgeW91IGhhdmUgdG8gdXBkYXRlIG1hbnkgb2JqZWN0cywgY29uc2lkZXIgY2xlYXJpbmcgYW5kIHJlYnVpbGRpbmcgdGhlXG4gICAgICogZW50aXJlIHRyZWUgb3IgdXNlIHRoZSBgZmFzdGAgZmxhZyB0byBjbGVhbnVwIGFmdGVyIHRoZSBsYXN0IHVwZGF0ZS5cbiAgICAgKiBAYmV0YVxuICAgICAqXG4gICAgICogQGV4YW1wbGVcbiAgICAgKiBgYGB0eXBlc2NyaXB0XG4gICAgICogY29uc3QgdHJlZSA9IG5ldyBRdWFkdHJlZSh7IHdpZHRoOiAxMDAsIGhlaWdodDogMTAwLCBtYXhPYmplY3RzOiAxIH0pO1xuICAgICAqIGNvbnN0IHJlY3QxID0gbmV3IFJlY3RhbmdsZSh7IHg6IDI1LCB5OiAyNSwgd2lkdGg6IDEwLCBoZWlnaHQ6IDEwIH0pO1xuICAgICAqIGNvbnN0IHJlY3QyID0gbmV3IFJlY3RhbmdsZSh7IHg6IDI1LCB5OiAyNSwgd2lkdGg6IDEwLCBoZWlnaHQ6IDEwIH0pO1xuICAgICAqIHRyZWUuaW5zZXJ0KHJlY3QxKTtcbiAgICAgKiB0cmVlLmluc2VydChyZWN0Mik7XG4gICAgICogcmVjdDEueCA9IDc1O1xuICAgICAqIHJlY3QxLnkgPSA3NTtcbiAgICAgKiB0cmVlLnVwZGF0ZShyZWN0MSk7XG4gICAgICogYGBgXG4gICAgICogQGV4YW1wbGUgQnVsayBmYXN0IHVwZGF0ZSBhbmQgZmluYWwgY2xlYW51cDpcbiAgICAgKiBgYGBqYXZhc2NyaXB0XG4gICAgICogY29uc3QgdHJlZSA9IG5ldyBRdWFkdHJlZSh7IHdpZHRoOiAxMDAsIGhlaWdodDogMTAwIH0pO1xuICAgICAqIGNvbnN0IHJlY3RzID0gW107XG4gICAgICogIGZvcihsZXQgaT0wOyBpPDIwOyBpKyspIHtcbiAgICAgKiAgICByZWN0c1tpXSA9IG5ldyBSZWN0YW5nbGUoeyB4OiAyMCwgeTogMjAsIHdpZHRoOiAyMCwgaGVpZ2h0OiAyMCB9KTtcbiAgICAgKiAgICB0cmVlLmluc2VydChyZWN0c1tpXSk7XG4gICAgICogIH1cbiAgICAgKiAgZm9yKGxldCBpPXJlY3RzLmxlbmd0aC0xOyBpPjA7IGktLSkge1xuICAgICAqICAgIHJlY3RzW2ldLnggPSAyMCArIE1hdGgucmFuZG9tKCkqNjA7XG4gICAgICogICAgcmVjdHNbaV0ueSA9IDIwICsgTWF0aC5yYW5kb20oKSo2MDtcbiAgICAgKiAgICAvL2Zhc3Q9dHJ1ZSDigJMganVzdCByZS1pbnNlcnQgdGhlIG9iamVjdCAobWF5IGxlYXZlcyB2YWNhbnQgc3Vibm9kZXMpXG4gICAgICogICAgLy9mYXN0PWZhbHNlIOKAkyBjbGVhbnVwIGVtcHR5IHN1Ym5vZGVzIChkZWZhdWx0KVxuICAgICAqICAgIGNvbnN0IGZhc3QgPSAoaSAhPT0gMCk7XG4gICAgICogICAgdHJlZS51cGRhdGUocmVjdHNbaV0sIGZhc3QpO1xuICAgICAqICB9XG4gICAgICogYGBgXG4gICAgICpcbiAgICAgKiBAcGFyYW0gb2JqIC0gT2JqZWN0IHRvIGJlIHVwZGF0ZWQuXG4gICAgICogQHBhcmFtIGZhc3QgLSBTZXQgdG8gdHJ1ZSB0byBpbmNyZWFzZSBwZXJmb3JtYW5jZSB0ZW1wb3JhcmlseSBieSBwcmV2ZW50aW5nIGNsZWFudXAgb2YgZW1wdHkgc3Vibm9kZXMgKG9wdGlvbmFsLCBkZWZhdWx0OiBmYWxzZSkuXG4gICAgICovXG4gICAgdXBkYXRlKG9iaiwgZmFzdCA9IGZhbHNlKSB7XG4gICAgICAgIHRoaXMucmVtb3ZlKG9iaiwgZmFzdCk7XG4gICAgICAgIHRoaXMuaW5zZXJ0KG9iaik7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRoZSBvcHBvc2l0ZSBvZiBhIHNwbGl0OiB0cnkgdG8gbWVyZ2UgYW5kIGRpc3NvbHZlIHN1Ym5vZGVzLlxuICAgICAqIEBiZXRhXG4gICAgICogQGludGVybmFsIE1vc3RseSBmb3IgaW50ZXJuYWwgdXNlISBZb3Ugc2hvdWxkIG9ubHkgY2FsbCB0aGlzIHlvdXJzZWxmIGlmIHlvdSBrbm93IHdoYXQgeW91IGFyZSBkb2luZy5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlIE1hbnVhbCBqb2luOlxuICAgICAqIGBgYHR5cGVzY3JpcHRcbiAgICAgKiBjb25zdCB0cmVlID0gbmV3IFF1YWR0cmVlKHsgd2lkdGg6IDEwMCwgaGVpZ2h0OiAxMDAgfSk7XG4gICAgICogdHJlZS5zcGxpdCgpO1xuICAgICAqIGNvbnNvbGUubG9nKHRyZWUubm9kZXMubGVuZ3RoKTsgLy8gNFxuICAgICAqIHRyZWUuam9pbigpO1xuICAgICAqIGNvbnNvbGUubG9nKHRyZWUubm9kZXMubGVuZ3RoKTsgLy8gMFxuICAgICAqIGBgYFxuICAgICAqXG4gICAgICogQHJldHVybnMgVGhlIG9iamVjdHMgZnJvbSB0aGlzIG5vZGUgYW5kIGFsbCBzdWJub2RlcyBjb21iaW5lZC5cbiAgICAgKi9cbiAgICBqb2luKCkge1xuICAgICAgICAvLyByZWN1cnNpdmUgam9pblxuICAgICAgICBsZXQgYWxsT2JqZWN0cyA9IEFycmF5LmZyb20odGhpcy5vYmplY3RzKTtcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjb25zdCBibGEgPSB0aGlzLm5vZGVzW2ldLmpvaW4oKTtcbiAgICAgICAgICAgIGFsbE9iamVjdHMgPSBhbGxPYmplY3RzLmNvbmNhdChibGEpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHJlbW92ZSBkdXBsaWNhdGVzXG4gICAgICAgIGNvbnN0IHVuaXF1ZU9iamVjdHMgPSBBcnJheS5mcm9tKG5ldyBTZXQoYWxsT2JqZWN0cykpO1xuICAgICAgICBpZiAodW5pcXVlT2JqZWN0cy5sZW5ndGggPD0gdGhpcy5tYXhPYmplY3RzKSB7XG4gICAgICAgICAgICB0aGlzLm9iamVjdHMgPSB1bmlxdWVPYmplY3RzO1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLm5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ub2Rlc1tpXS5vYmplY3RzID0gW107XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLm5vZGVzID0gW107XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGFsbE9iamVjdHM7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENsZWFyIHRoZSBRdWFkdHJlZS5cbiAgICAgKlxuICAgICAqIEBleGFtcGxlXG4gICAgICogYGBgdHlwZXNjcmlwdFxuICAgICAqIGNvbnN0IHRyZWUgPSBuZXcgUXVhZHRyZWUoeyB3aWR0aDogMTAwLCBoZWlnaHQ6IDEwMCB9KTtcbiAgICAgKiB0cmVlLmluc2VydChuZXcgQ2lyY2xlKHsgeDogMjUsIHk6IDI1LCByOiAxMCB9KSk7XG4gICAgICogdHJlZS5jbGVhcigpO1xuICAgICAqIGNvbnNvbGUubG9nKHRyZWUpOyAvLyB0cmVlLm9iamVjdHMgYW5kIHRyZWUubm9kZXMgYXJlIGVtcHR5XG4gICAgICogYGBgXG4gICAgICovXG4gICAgY2xlYXIoKSB7XG4gICAgICAgIHRoaXMub2JqZWN0cyA9IFtdO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMubm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm5vZGVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZXNbaV0uY2xlYXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5vZGVzID0gW107XG4gICAgfVxufVxuXG4vKipcbiAqIENsYXNzIHJlcHJlc2VudGluZyBhIFJlY3RhbmdsZVxuICogQHR5cGVQYXJhbSBDdXN0b21EYXRhVHlwZSAtIFR5cGUgb2YgdGhlIGN1c3RvbSBkYXRhIHByb3BlcnR5IChvcHRpb25hbCwgaW5mZXJyZWQgYXV0b21hdGljYWxseSkuXG4gKlxuICogQGV4YW1wbGUgV2l0aG91dCBjdXN0b20gZGF0YSAoSlMvVFMpOlxuICogYGBgdHlwZXNjcmlwdFxuICogY29uc3QgcmVjdGFuZ2xlID0gbmV3IFJlY3RhbmdsZSh7XG4gKiAgIHg6IDEwLFxuICogICB5OiAyMCxcbiAqICAgd2lkdGg6IDMwLFxuICogICBoZWlnaHQ6IDQwLFxuICogfSk7XG4gKiBgYGBcbiAqXG4gKiBAZXhhbXBsZSBXaXRoIGN1c3RvbSBkYXRhIChKUy9UUyk6XG4gKiBgYGBqYXZhc2NyaXB0XG4gKiBjb25zdCByZWN0YW5nbGUgPSBuZXcgUmVjdGFuZ2xlKHtcbiAqICAgeDogMTAsXG4gKiAgIHk6IDIwLFxuICogICB3aWR0aDogMzAsXG4gKiAgIGhlaWdodDogNDAsXG4gKiAgIGRhdGE6IHtcbiAqICAgICBuYW1lOiAnSmFuZScsXG4gKiAgICAgaGVhbHRoOiAxMDAsXG4gKiAgIH0sXG4gKiB9KTtcbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlIFdpdGggY3VzdG9tIGRhdGEgKFRTKTpcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGludGVyZmFjZSBPYmplY3REYXRhIHtcbiAqICAgbmFtZTogc3RyaW5nXG4gKiAgIGhlYWx0aDogbnVtYmVyXG4gKiB9XG4gKiBjb25zdCBlbnRpdHk6IE9iamVjdERhdGEgPSB7XG4gKiAgIG5hbWU6ICdKYW5lJyxcbiAqICAgaGVhbHRoOiAxMDAsXG4gKiB9O1xuICpcbiAqIC8vIFR5cGVzY3JpcHQgd2lsbCBpbmZlciB0aGUgdHlwZSBvZiB0aGUgZGF0YSBwcm9wZXJ0eVxuICogY29uc3QgcmVjdGFuZ2xlMSA9IG5ldyBSZWN0YW5nbGUoe1xuICogICB4OiAxMCxcbiAqICAgeTogMjAsXG4gKiAgIHdpZHRoOiAzMCxcbiAqICAgaGVpZ2h0OiA0MCxcbiAqICAgZGF0YTogZW50aXR5LFxuICogfSk7XG4gKlxuICogLy8gWW91IGNhbiBhbHNvIHBhc3MgaW4gYSBnZW5lcmljIHR5cGUgZm9yIHRoZSBkYXRhIHByb3BlcnR5XG4gKiBjb25zdCByZWN0YW5nbGUyID0gbmV3IFJlY3RhbmdsZTxPYmplY3REYXRhPih7XG4gKiAgIHg6IDEwLFxuICogICB5OiAyMCxcbiAqICAgd2lkdGg6IDMwLFxuICogICBoZWlnaHQ6IDQwLFxuICogfSk7XG4gKiByZWN0YW5nbGUyLmRhdGEgPSBlbnRpdHk7XG4gKiBgYGBcbiAqXG4gKiBAZXhhbXBsZSBXaXRoIGN1c3RvbSBjbGFzcyBleHRlbmRpbmcgUmVjdGFuZ2xlIChpbXBsZW1lbnRzIHtAbGluayBSZWN0YW5nbGVHZW9tZXRyeX0gKHgsIHksIHdpZHRoLCBoZWlnaHQpKTpcbiAqIGBgYGphdmFzY3JpcHRcbiAqIC8vIGV4dGVuZGluZyBpbmhlcml0cyB0aGUgcXRJbmRleCBtZXRob2RcbiAqIGNsYXNzIEJveCBleHRlbmRzIFJlY3RhbmdsZSB7XG4gKlxuICogICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICogICAgIC8vIGNhbGwgc3VwZXIgdG8gc2V0IHgsIHksIHdpZHRoLCBoZWlnaHQgKGFuZCBkYXRhLCBpZiBnaXZlbilcbiAqICAgICBzdXBlcihwcm9wcyk7XG4gKiAgICAgdGhpcy5jb250ZW50ID0gcHJvcHMuY29udGVudDtcbiAqICAgfVxuICogfVxuICpcbiAqIGNvbnN0IGJveCA9IG5ldyBCb3goe1xuICogICBjb250ZW50OiAnR3Jhdml0eSBCb290cycsXG4gKiAgIHg6IDEwLFxuICogICB5OiAyMCxcbiAqICAgd2lkdGg6IDMwLFxuICogICBoZWlnaHQ6IDQwLFxuICogfSk7XG4gKiBgYGBcbiAqXG4gKiBAZXhhbXBsZSBXaXRoIGN1c3RvbSBjbGFzcyBhbmQgbWFwcGluZyB7QGxpbmsgUmVjdGFuZ2xlR2VvbWV0cnl9OlxuICogYGBgamF2YXNjcmlwdFxuICogLy8gbm8gbmVlZCB0byBleHRlbmQgaWYgeW91IGRvbid0IGltcGxlbWVudCBSZWN0YW5nbGVHZW9tZXRyeVxuICogY2xhc3MgQm94IHtcbiAqXG4gKiAgIGNvbnN0cnVjdG9yKGNvbnRlbnQpIHtcbiAqICAgICB0aGlzLmNvbnRlbnQgPSBjb250ZW50O1xuICogICAgIHRoaXMucG9zaXRpb24gPSBbMTAsIDIwXTtcbiAqICAgICB0aGlzLnNpemUgPSBbMzAsIDQwXTtcbiAqICAgfVxuICpcbiAqICAgLy8gYWRkIGEgcXRJbmRleCBtZXRob2QgdG8geW91ciBjbGFzc1xuICogICBxdEluZGV4KG5vZGUpIHtcbiAqICAgICAvLyBtYXAgeW91ciBwcm9wZXJ0aWVzIHRvIFJlY3RhbmdsZUdlb21ldHJ5XG4gKiAgICAgcmV0dXJuIFJlY3RhbmdsZS5wcm90b3R5cGUucXRJbmRleC5jYWxsKHtcbiAqICAgICAgIHg6IHRoaXMucG9zaXRpb25bMF0sXG4gKiAgICAgICB5OiB0aGlzLnBvc2l0aW9uWzFdLFxuICogICAgICAgd2lkdGg6IHRoaXMuc2l6ZVswXSxcbiAqICAgICAgIGhlaWdodDogdGhpcy5zaXplWzFdLFxuICogICAgIH0sIG5vZGUpO1xuICogICB9XG4gKiB9XG4gKlxuICogY29uc3QgYm94ID0gbmV3IEJveCgnR3Jhdml0eSBCb290cycpO1xuICogYGBgXG4gKlxuICogQGV4YW1wbGUgV2l0aCBjdXN0b20gb2JqZWN0IHRoYXQgaW1wbGVtZW50cyB7QGxpbmsgUmVjdGFuZ2xlR2VvbWV0cnl9OlxuICogYGBgamF2YXNjcmlwdFxuICogY29uc3QgcGxheWVyID0ge1xuICogICBuYW1lOiAnSmFuZScsXG4gKiAgIGhlYWx0aDogMTAwLFxuICogICB4OiAxMCxcbiAqICAgeTogMjAsXG4gKiAgIHdpZHRoOiAzMCxcbiAqICAgaGVpZ2h0OiAzMCxcbiAqICAgcXRJbmRleDogUmVjdGFuZ2xlLnByb3RvdHlwZS5xdEluZGV4LFxuICogfSk7XG4gKiBgYGBcbiAqXG4gKiBAZXhhbXBsZSBXaXRoIGN1c3RvbSBvYmplY3QgYW5kIG1hcHBpbmcge0BsaW5rIFJlY3RhbmdsZUdlb21ldHJ5fTpcbiAqIGBgYGphdmFzY3JpcHRcbiAqIC8vIE5vdGU6IHRoaXMgaXMgbm90IHJlY29tbWVuZGVkIGJ1dCBwb3NzaWJsZS5cbiAqIC8vIFVzaW5nIHRoaXMgdGVjaG5pcXVlLCBlYWNoIG9iamVjdCB3b3VsZCBoYXZlIGl0J3Mgb3duIHF0SW5kZXggbWV0aG9kLlxuICogLy8gUmF0aGVyIGFkZCBxdEluZGV4IHRvIHlvdXIgcHJvdG90eXBlLCBlLmcuIGJ5IHVzaW5nIGNsYXNzZXMgbGlrZSBzaG93biBhYm92ZS5cbiAqIGNvbnN0IHBsYXllciA9IHtcbiAqICAgbmFtZTogJ0phbmUnLFxuICogICBoZWFsdGg6IDEwMCxcbiAqICAgcG9zaXRpb246IFsxMCwgMjBdLFxuICogICBzaXplOiBbMzAsIDQwXSxcbiAqICAgcXRJbmRleDogZnVuY3Rpb24obm9kZSkge1xuICogICAgIHJldHVybiBSZWN0YW5nbGUucHJvdG90eXBlLnF0SW5kZXguY2FsbCh7XG4gKiAgICAgICB4OiB0aGlzLnBvc2l0aW9uWzBdLFxuICogICAgICAgeTogdGhpcy5wb3NpdGlvblsxXSxcbiAqICAgICAgIHdpZHRoOiB0aGlzLnNpemVbMF0sXG4gKiAgICAgICBoZWlnaHQ6IHRoaXMuc2l6ZVsxXSxcbiAqICAgICB9LCBub2RlKTtcbiAqICAgfSxcbiAqIH0pO1xuICogYGBgXG4gKi9cbmNsYXNzIFJlY3RhbmdsZSB7XG4gICAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICAgICAgdGhpcy54ID0gcHJvcHMueDtcbiAgICAgICAgdGhpcy55ID0gcHJvcHMueTtcbiAgICAgICAgdGhpcy53aWR0aCA9IHByb3BzLndpZHRoO1xuICAgICAgICB0aGlzLmhlaWdodCA9IHByb3BzLmhlaWdodDtcbiAgICAgICAgdGhpcy5kYXRhID0gcHJvcHMuZGF0YTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lIHdoaWNoIHF1YWRyYW50IHRoaXMgcmVjdGFuZ2xlIGJlbG9uZ3MgdG8uXG4gICAgICogQHBhcmFtIG5vZGUgLSBRdWFkdHJlZSBub2RlIHRvIGJlIGNoZWNrZWRcbiAgICAgKiBAcmV0dXJucyBBcnJheSBjb250YWluaW5nIGluZGV4ZXMgb2YgaW50ZXJzZWN0aW5nIHN1Ym5vZGVzICgwLTMgPSB0b3AtcmlnaHQsIHRvcC1sZWZ0LCBib3R0b20tbGVmdCwgYm90dG9tLXJpZ2h0KVxuICAgICAqL1xuICAgIHF0SW5kZXgobm9kZSkge1xuICAgICAgICBjb25zdCBpbmRleGVzID0gW10sIGJvdW5kc0NlbnRlclggPSBub2RlLnggKyAobm9kZS53aWR0aCAvIDIpLCBib3VuZHNDZW50ZXJZID0gbm9kZS55ICsgKG5vZGUuaGVpZ2h0IC8gMik7XG4gICAgICAgIGNvbnN0IHN0YXJ0SXNOb3J0aCA9IHRoaXMueSA8IGJvdW5kc0NlbnRlclksIHN0YXJ0SXNXZXN0ID0gdGhpcy54IDwgYm91bmRzQ2VudGVyWCwgZW5kSXNFYXN0ID0gdGhpcy54ICsgdGhpcy53aWR0aCA+IGJvdW5kc0NlbnRlclgsIGVuZElzU291dGggPSB0aGlzLnkgKyB0aGlzLmhlaWdodCA+IGJvdW5kc0NlbnRlclk7XG4gICAgICAgIC8vdG9wLXJpZ2h0IHF1YWRcbiAgICAgICAgaWYgKHN0YXJ0SXNOb3J0aCAmJiBlbmRJc0Vhc3QpIHtcbiAgICAgICAgICAgIGluZGV4ZXMucHVzaCgwKTtcbiAgICAgICAgfVxuICAgICAgICAvL3RvcC1sZWZ0IHF1YWRcbiAgICAgICAgaWYgKHN0YXJ0SXNXZXN0ICYmIHN0YXJ0SXNOb3J0aCkge1xuICAgICAgICAgICAgaW5kZXhlcy5wdXNoKDEpO1xuICAgICAgICB9XG4gICAgICAgIC8vYm90dG9tLWxlZnQgcXVhZFxuICAgICAgICBpZiAoc3RhcnRJc1dlc3QgJiYgZW5kSXNTb3V0aCkge1xuICAgICAgICAgICAgaW5kZXhlcy5wdXNoKDIpO1xuICAgICAgICB9XG4gICAgICAgIC8vYm90dG9tLXJpZ2h0IHF1YWRcbiAgICAgICAgaWYgKGVuZElzRWFzdCAmJiBlbmRJc1NvdXRoKSB7XG4gICAgICAgICAgICBpbmRleGVzLnB1c2goMyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGluZGV4ZXM7XG4gICAgfVxufVxuXG4vKipcbiAqIENsYXNzIHJlcHJlc2VudGluZyBhIENpcmNsZS5cbiAqIEB0eXBlUGFyYW0gQ3VzdG9tRGF0YVR5cGUgLSBUeXBlIG9mIHRoZSBjdXN0b20gZGF0YSBwcm9wZXJ0eSAob3B0aW9uYWwsIGluZmVycmVkIGF1dG9tYXRpY2FsbHkpLlxuICpcbiAqIEBleGFtcGxlIFdpdGhvdXQgY3VzdG9tIGRhdGEgKEpTL1RTKTpcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGNvbnN0IGNpcmNsZSA9IG5ldyBDaXJjbGUoe1xuICogICB4OiAxMDAsXG4gKiAgIHk6IDEwMCxcbiAqICAgcjogMzIsXG4gKiB9KTtcbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlIFdpdGggY3VzdG9tIGRhdGEgKEpTL1RTKTpcbiAqIGBgYGphdmFzY3JpcHRcbiAqIGNvbnN0IGNpcmNsZSA9IG5ldyBDaXJjbGUoe1xuICogICB4OiAxMDAsXG4gKiAgIHk6IDEwMCxcbiAqICAgcjogMzIsXG4gKiAgIGRhdGE6IHtcbiAqICAgICBuYW1lOiAnSmFuZScsXG4gKiAgICAgaGVhbHRoOiAxMDAsXG4gKiAgIH0sXG4gKiB9KTtcbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlIFdpdGggY3VzdG9tIGRhdGEgKFRTKTpcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGludGVyZmFjZSBPYmplY3REYXRhIHtcbiAqICAgbmFtZTogc3RyaW5nXG4gKiAgIGhlYWx0aDogbnVtYmVyXG4gKiB9XG4gKiBjb25zdCBlbnRpdHk6IE9iamVjdERhdGEgPSB7XG4gKiAgIG5hbWU6ICdKYW5lJyxcbiAqICAgaGVhbHRoOiAxMDAsXG4gKiB9O1xuICpcbiAqIC8vIFR5cGVzY3JpcHQgd2lsbCBpbmZlciB0aGUgdHlwZSBvZiB0aGUgZGF0YSBwcm9wZXJ0eVxuICogY29uc3QgY2lyY2xlMSA9IG5ldyBDaXJjbGUoe1xuICogICB4OiAxMDAsXG4gKiAgIHk6IDEwMCxcbiAqICAgcjogMzIsXG4gKiAgIGRhdGE6IGVudGl0eSxcbiAqIH0pO1xuICpcbiAqIC8vIFlvdSBjYW4gYWxzbyBwYXNzIGluIGEgZ2VuZXJpYyB0eXBlIGZvciB0aGUgZGF0YSBwcm9wZXJ0eVxuICogY29uc3QgY2lyY2xlMiA9IG5ldyBDaXJjbGU8T2JqZWN0RGF0YT4oe1xuICogICB4OiAxMDAsXG4gKiAgIHk6IDEwMCxcbiAqICAgcjogMzIsXG4gKiB9KTtcbiAqIGNpcmNsZTIuZGF0YSA9IGVudGl0eTtcbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlIFdpdGggY3VzdG9tIGNsYXNzIGV4dGVuZGluZyBDaXJjbGUgKGltcGxlbWVudHMge0BsaW5rIENpcmNsZUdlb21ldHJ5fSAoeCwgeSwgcikpOlxuICogYGBgamF2YXNjcmlwdFxuICogLy8gZXh0ZW5kaW5nIGluaGVyaXRzIHRoZSBxdEluZGV4IG1ldGhvZFxuICogY2xhc3MgQm9tYiBleHRlbmRzIENpcmNsZSB7XG4gKlxuICogICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICogICAgIC8vIGNhbGwgc3VwZXIgdG8gc2V0IHgsIHksIHIgKGFuZCBkYXRhLCBpZiBnaXZlbilcbiAqICAgICBzdXBlcihwcm9wcyk7XG4gKiAgICAgdGhpcy5jb3VudGRvd24gPSBwcm9wcy5jb3VudGRvd247XG4gKiAgIH1cbiAqIH1cbiAqXG4gKiBjb25zdCBib21iID0gbmV3IEJvbWIoe1xuICogICBjb3VudGRvd246IDUsXG4gKiAgIHg6IDEwLFxuICogICB5OiAyMCxcbiAqICAgcjogMzAsXG4gKiB9KTtcbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlIFdpdGggY3VzdG9tIGNsYXNzIGFuZCBtYXBwaW5nIHtAbGluayBDaXJjbGVHZW9tZXRyeX06XG4gKiBgYGBqYXZhc2NyaXB0XG4gKiAvLyBubyBuZWVkIHRvIGV4dGVuZCBpZiB5b3UgZG9uJ3QgaW1wbGVtZW50IENpcmNsZUdlb21ldHJ5XG4gKiBjbGFzcyBCb21iIHtcbiAqXG4gKiAgIGNvbnN0cnVjdG9yKGNvdW50ZG93bikge1xuICogICAgIHRoaXMuY291bnRkb3duID0gY291bnRkb3duO1xuICogICAgIHRoaXMucG9zaXRpb24gPSBbMTAsIDIwXTtcbiAqICAgICB0aGlzLnJhZGl1cyA9IDMwO1xuICogICB9XG4gKlxuICogICAvLyBhZGQgYSBxdEluZGV4IG1ldGhvZCB0byB5b3VyIGNsYXNzXG4gKiAgIHF0SW5kZXgobm9kZSkge1xuICogICAgIC8vIG1hcCB5b3VyIHByb3BlcnRpZXMgdG8gQ2lyY2xlR2VvbWV0cnlcbiAqICAgICByZXR1cm4gQ2lyY2xlLnByb3RvdHlwZS5xdEluZGV4LmNhbGwoe1xuICogICAgICAgeDogdGhpcy5wb3NpdGlvblswXSxcbiAqICAgICAgIHk6IHRoaXMucG9zaXRpb25bMV0sXG4gKiAgICAgICByOiB0aGlzLnJhZGl1cyxcbiAqICAgICB9LCBub2RlKTtcbiAqICAgfVxuICogfVxuICpcbiAqIGNvbnN0IGJvbWIgPSBuZXcgQm9tYig1KTtcbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlIFdpdGggY3VzdG9tIG9iamVjdCB0aGF0IGltcGxlbWVudHMge0BsaW5rIENpcmNsZUdlb21ldHJ5fTpcbiAqIGBgYGphdmFzY3JpcHRcbiAqIGNvbnN0IHBsYXllciA9IHtcbiAqICAgbmFtZTogJ0phbmUnLFxuICogICBoZWFsdGg6IDEwMCxcbiAqICAgeDogMTAsXG4gKiAgIHk6IDIwLFxuICogICByOiAzMCxcbiAqICAgcXRJbmRleDogQ2lyY2xlLnByb3RvdHlwZS5xdEluZGV4LFxuICogfSk7XG4gKiBgYGBcbiAqXG4gKiBAZXhhbXBsZSBXaXRoIGN1c3RvbSBvYmplY3QgYW5kIG1hcHBpbmcge0BsaW5rIENpcmNsZUdlb21ldHJ5fTpcbiAqIGBgYGphdmFzY3JpcHRcbiAqIC8vIE5vdGU6IHRoaXMgaXMgbm90IHJlY29tbWVuZGVkIGJ1dCBwb3NzaWJsZS5cbiAqIC8vIFVzaW5nIHRoaXMgdGVjaG5pcXVlLCBlYWNoIG9iamVjdCB3b3VsZCBoYXZlIGl0J3Mgb3duIHF0SW5kZXggbWV0aG9kLlxuICogLy8gUmF0aGVyIGFkZCBxdEluZGV4IHRvIHlvdXIgcHJvdG90eXBlLCBlLmcuIGJ5IHVzaW5nIGNsYXNzZXMgbGlrZSBzaG93biBhYm92ZS5cbiAqIGNvbnN0IHBsYXllciA9IHtcbiAqICAgbmFtZTogJ0phbmUnLFxuICogICBoZWFsdGg6IDEwMCxcbiAqICAgcG9zaXRpb246IFsxMCwgMjBdLFxuICogICByYWRpdXM6IDMwLFxuICogICBxdEluZGV4OiBmdW5jdGlvbihub2RlKSB7XG4gKiAgICAgcmV0dXJuIENpcmNsZS5wcm90b3R5cGUucXRJbmRleC5jYWxsKHtcbiAqICAgICAgIHg6IHRoaXMucG9zaXRpb25bMF0sXG4gKiAgICAgICB5OiB0aGlzLnBvc2l0aW9uWzFdLFxuICogICAgICAgcjogdGhpcy5yYWRpdXMsXG4gKiAgICAgfSwgbm9kZSk7XG4gKiAgIH0sXG4gKiB9KTtcbiAqIGBgYFxuICovXG5jbGFzcyBDaXJjbGUge1xuICAgIC8qKlxuICAgICAqIENpcmNsZSBDb25zdHJ1Y3RvclxuICAgICAqIEBwYXJhbSBwcm9wcyAtIENpcmNsZSBwcm9wZXJ0aWVzXG4gICAgICogQHR5cGVQYXJhbSBDdXN0b21EYXRhVHlwZSAtIFR5cGUgb2YgdGhlIGN1c3RvbSBkYXRhIHByb3BlcnR5IChvcHRpb25hbCwgaW5mZXJyZWQgYXV0b21hdGljYWxseSkuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICAgICAgdGhpcy54ID0gcHJvcHMueDtcbiAgICAgICAgdGhpcy55ID0gcHJvcHMueTtcbiAgICAgICAgdGhpcy5yID0gcHJvcHMucjtcbiAgICAgICAgdGhpcy5kYXRhID0gcHJvcHMuZGF0YTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lIHdoaWNoIHF1YWRyYW50IHRoaXMgY2lyY2xlIGJlbG9uZ3MgdG8uXG4gICAgICogQHBhcmFtIG5vZGUgLSBRdWFkdHJlZSBub2RlIHRvIGJlIGNoZWNrZWRcbiAgICAgKiBAcmV0dXJucyBBcnJheSBjb250YWluaW5nIGluZGV4ZXMgb2YgaW50ZXJzZWN0aW5nIHN1Ym5vZGVzICgwLTMgPSB0b3AtcmlnaHQsIHRvcC1sZWZ0LCBib3R0b20tbGVmdCwgYm90dG9tLXJpZ2h0KVxuICAgICAqL1xuICAgIHF0SW5kZXgobm9kZSkge1xuICAgICAgICBjb25zdCBpbmRleGVzID0gW10sIHcyID0gbm9kZS53aWR0aCAvIDIsIGgyID0gbm9kZS5oZWlnaHQgLyAyLCB4MiA9IG5vZGUueCArIHcyLCB5MiA9IG5vZGUueSArIGgyO1xuICAgICAgICAvL2FuIGFycmF5IG9mIG5vZGUgb3JpZ2lucyB3aGVyZSB0aGUgYXJyYXkgaW5kZXggZXF1YWxzIHRoZSBub2RlIGluZGV4XG4gICAgICAgIGNvbnN0IG5vZGVzID0gW1xuICAgICAgICAgICAgW3gyLCBub2RlLnldLFxuICAgICAgICAgICAgW25vZGUueCwgbm9kZS55XSxcbiAgICAgICAgICAgIFtub2RlLngsIHkyXSxcbiAgICAgICAgICAgIFt4MiwgeTJdLFxuICAgICAgICBdO1xuICAgICAgICAvL3Rlc3QgYWxsIG5vZGVzIGZvciBjaXJjbGUgaW50ZXJzZWN0aW9uc1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5vZGVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoQ2lyY2xlLmludGVyc2VjdFJlY3QodGhpcy54LCB0aGlzLnksIHRoaXMuciwgbm9kZXNbaV1bMF0sIG5vZGVzW2ldWzFdLCBub2Rlc1tpXVswXSArIHcyLCBub2Rlc1tpXVsxXSArIGgyKSkge1xuICAgICAgICAgICAgICAgIGluZGV4ZXMucHVzaChpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaW5kZXhlcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ2hlY2sgaWYgYSBjaXJjbGUgaW50ZXJzZWN0cyBhbiBheGlzIGFsaWduZWQgcmVjdGFuZ2xlLlxuICAgICAqIEBiZXRhXG4gICAgICogQHNlZSBodHRwczovL3lhbC5jYy9yZWN0YW5nbGUtY2lyY2xlLWludGVyc2VjdGlvbi10ZXN0L1xuICAgICAqIEBwYXJhbSB4IC0gY2lyY2xlIGNlbnRlciBYXG4gICAgICogQHBhcmFtIHkgLSBjaXJjbGUgY2VudGVyIFlcbiAgICAgKiBAcGFyYW0gciAtIGNpcmNsZSByYWRpdXNcbiAgICAgKiBAcGFyYW0gbWluWCAtIHJlY3RhbmdsZSBzdGFydCBYXG4gICAgICogQHBhcmFtIG1pblkgLSByZWN0YW5nbGUgc3RhcnQgWVxuICAgICAqIEBwYXJhbSBtYXhYIC0gcmVjdGFuZ2xlIGVuZCBYXG4gICAgICogQHBhcmFtIG1heFkgLSByZWN0YW5nbGUgZW5kIFlcbiAgICAgKiBAcmV0dXJucyB0cnVlIGlmIGNpcmNsZSBpbnRlcnNlY3RzIHJlY3RhbmdsZVxuICAgICAqXG4gICAgICogQGV4YW1wbGUgQ2hlY2sgaWYgYSBjaXJjbGUgaW50ZXJzZWN0cyBhIHJlY3RhbmdsZTpcbiAgICAgKiBgYGBqYXZhc2NyaXB0XG4gICAgICogY29uc3QgY2lyYyA9IHsgeDogMTAsIHk6IDIwLCByOiAzMCB9O1xuICAgICAqIGNvbnN0IHJlY3QgPSB7IHg6IDQwLCB5OiA1MCwgd2lkdGg6IDYwLCBoZWlnaHQ6IDcwIH07XG4gICAgICogY29uc3QgaW50ZXJzZWN0ID0gQ2lyY2xlLmludGVyc2VjdFJlY3QoXG4gICAgICogICBjaXJjLngsXG4gICAgICogICBjaXJjLnksXG4gICAgICogICBjaXJjLnIsXG4gICAgICogICByZWN0LngsXG4gICAgICogICByZWN0LnksXG4gICAgICogICByZWN0LnggKyByZWN0LndpZHRoLFxuICAgICAqICAgcmVjdC55ICsgcmVjdC5oZWlnaHQsXG4gICAgICogKTtcbiAgICAgKiBjb25zb2xlLmxvZyhjaXJjbGUsIHJlY3QsICdpbnRlcnNlY3Q/JywgaW50ZXJzZWN0KTtcbiAgICAgKiBgYGBcbiAgICAgKi9cbiAgICBzdGF0aWMgaW50ZXJzZWN0UmVjdCh4LCB5LCByLCBtaW5YLCBtaW5ZLCBtYXhYLCBtYXhZKSB7XG4gICAgICAgIGNvbnN0IGRlbHRhWCA9IHggLSBNYXRoLm1heChtaW5YLCBNYXRoLm1pbih4LCBtYXhYKSk7XG4gICAgICAgIGNvbnN0IGRlbHRhWSA9IHkgLSBNYXRoLm1heChtaW5ZLCBNYXRoLm1pbih5LCBtYXhZKSk7XG4gICAgICAgIHJldHVybiAoZGVsdGFYICogZGVsdGFYICsgZGVsdGFZICogZGVsdGFZKSA8IChyICogcik7XG4gICAgfVxufVxuXG4vKipcbiAqIENsYXNzIHJlcHJlc2VudGluZyBhIExpbmVcbiAqIEB0eXBlUGFyYW0gQ3VzdG9tRGF0YVR5cGUgLSBUeXBlIG9mIHRoZSBjdXN0b20gZGF0YSBwcm9wZXJ0eSAob3B0aW9uYWwsIGluZmVycmVkIGF1dG9tYXRpY2FsbHkpLlxuICpcbiAqIEBleGFtcGxlIFdpdGhvdXQgY3VzdG9tIGRhdGEgKEpTL1RTKTpcbiAqIGBgYHR5cGVzY3JpcHRcbiAqIGNvbnN0IGxpbmUgPSBuZXcgTGluZSh7XG4gKiAgIHgxOiAxMCxcbiAqICAgeTE6IDIwLFxuICogICB4MjogMzAsXG4gKiAgIHkyOiA0MCxcbiAqIH0pO1xuICogYGBgXG4gKlxuICogQGV4YW1wbGUgV2l0aCBjdXN0b20gZGF0YSAoSlMvVFMpOlxuICogYGBgamF2YXNjcmlwdFxuICogY29uc3QgbGluZSA9IG5ldyBMaW5lKHtcbiAqICAgeDE6IDEwLFxuICogICB5MTogMjAsXG4gKiAgIHgyOiAzMCxcbiAqICAgeTI6IDQwLFxuICogICBkYXRhOiB7XG4gKiAgICAgbmFtZTogJ0phbmUnLFxuICogICAgIGhlYWx0aDogMTAwLFxuICogICB9LFxuICogfSk7XG4gKiBgYGBcbiAqXG4gKiBAZXhhbXBsZSBXaXRoIGN1c3RvbSBkYXRhIChUUyk6XG4gKiBgYGB0eXBlc2NyaXB0XG4gKiBpbnRlcmZhY2UgT2JqZWN0RGF0YSB7XG4gKiAgIG5hbWU6IHN0cmluZ1xuICogICBoZWFsdGg6IG51bWJlclxuICogfVxuICogY29uc3QgZW50aXR5OiBPYmplY3REYXRhID0ge1xuICogICBuYW1lOiAnSmFuZScsXG4gKiAgIGhlYWx0aDogMTAwLFxuICogfTtcbiAqXG4gKiAvLyBUeXBlc2NyaXB0IHdpbGwgaW5mZXIgdGhlIHR5cGUgb2YgdGhlIGRhdGEgcHJvcGVydHlcbiAqIGNvbnN0IGxpbmUxID0gbmV3IExpbmUoe1xuICogICB4MTogMTAsXG4gKiAgIHkxOiAyMCxcbiAqICAgeDI6IDMwLFxuICogICB5MjogNDAsXG4gKiAgIGRhdGE6IGVudGl0eSxcbiAqIH0pO1xuICpcbiAqIC8vIFlvdSBjYW4gYWxzbyBwYXNzIGluIGEgZ2VuZXJpYyB0eXBlIGZvciB0aGUgZGF0YSBwcm9wZXJ0eVxuICogY29uc3QgbGluZTIgPSBuZXcgTGluZTxPYmplY3REYXRhPih7XG4gKiAgIHgxOiAxMCxcbiAqICAgeTE6IDIwLFxuICogICB4MjogMzAsXG4gKiAgIHkyOiA0MCxcbiAqIH0pO1xuICogbGluZTIuZGF0YSA9IGVudGl0eTtcbiAqIGBgYFxuICpcbiAqIEBleGFtcGxlIFdpdGggY3VzdG9tIGNsYXNzIGV4dGVuZGluZyBMaW5lIChpbXBsZW1lbnRzIHtAbGluayBMaW5lR2VvbWV0cnl9ICh4MSwgeTEsIHgyLCB5MikpOlxuICogYGBgamF2YXNjcmlwdFxuICogLy8gZXh0ZW5kaW5nIGluaGVyaXRzIHRoZSBxdEluZGV4IG1ldGhvZFxuICogY2xhc3MgTGFzZXIgZXh0ZW5kcyBMaW5lIHtcbiAqXG4gKiAgIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gKiAgICAgLy8gY2FsbCBzdXBlciB0byBzZXQgeDEsIHkxLCB4MiwgeTIgKGFuZCBkYXRhLCBpZiBnaXZlbilcbiAqICAgICBzdXBlcihwcm9wcyk7XG4gKiAgICAgdGhpcy5jb2xvciA9IHByb3BzLmNvbG9yO1xuICogICB9XG4gKiB9XG4gKlxuICogY29uc3QgbGFzZXIgPSBuZXcgTGFzZXIoe1xuICogICBjb2xvcjogJ2dyZWVuJyxcbiAqICAgeDE6IDEwLFxuICogICB5MTogMjAsXG4gKiAgIHgyOiAzMCxcbiAqICAgeTI6IDQwLFxuICogfSk7XG4gKiBgYGBcbiAqXG4gKiBAZXhhbXBsZSBXaXRoIGN1c3RvbSBjbGFzcyBhbmQgbWFwcGluZyB7QGxpbmsgTGluZUdlb21ldHJ5fTpcbiAqIGBgYGphdmFzY3JpcHRcbiAqIC8vIG5vIG5lZWQgdG8gZXh0ZW5kIGlmIHlvdSBkb24ndCBpbXBsZW1lbnQgTGluZUdlb21ldHJ5XG4gKiBjbGFzcyBMYXNlciB7XG4gKlxuICogICBjb25zdHJ1Y3Rvcihjb2xvcikge1xuICogICAgIHRoaXMuY29sb3IgPSBjb2xvcjtcbiAqICAgICB0aGlzLnN0YXJ0ID0gWzEwLCAyMF07XG4gKiAgICAgdGhpcy5lbmQgPSBbMzAsIDQwXTtcbiAqICAgfVxuICpcbiAqICAgLy8gYWRkIGEgcXRJbmRleCBtZXRob2QgdG8geW91ciBjbGFzc1xuICogICBxdEluZGV4KG5vZGUpIHtcbiAqICAgICAvLyBtYXAgeW91ciBwcm9wZXJ0aWVzIHRvIExpbmVHZW9tZXRyeVxuICogICAgIHJldHVybiBMaW5lLnByb3RvdHlwZS5xdEluZGV4LmNhbGwoe1xuICogICAgICAgeDE6IHRoaXMuc3RhcnRbMF0sXG4gKiAgICAgICB5MTogdGhpcy5zdGFydFsxXSxcbiAqICAgICAgIHgyOiB0aGlzLmVuZFswXSxcbiAqICAgICAgIHkyOiB0aGlzLmVuZFsxXSxcbiAqICAgICB9LCBub2RlKTtcbiAqICAgfVxuICogfVxuICpcbiAqIGNvbnN0IGxhc2VyID0gbmV3IExhc2VyKCdncmVlbicpO1xuICogYGBgXG4gKlxuICogQGV4YW1wbGUgV2l0aCBjdXN0b20gb2JqZWN0IHRoYXQgaW1wbGVtZW50cyB7QGxpbmsgTGluZUdlb21ldHJ5fTpcbiAqIGBgYGphdmFzY3JpcHRcbiAqIGNvbnN0IHBsYXllciA9IHtcbiAqICAgbmFtZTogJ0phbmUnLFxuICogICBoZWFsdGg6IDEwMCxcbiAqICAgeDE6IDEwLFxuICogICB5MTogMjAsXG4gKiAgIHgyOiAzMCxcbiAqICAgeTI6IDQwLFxuICogICBxdEluZGV4OiBMaW5lLnByb3RvdHlwZS5xdEluZGV4LFxuICogfSk7XG4gKiBgYGBcbiAqXG4gKiBAZXhhbXBsZSBXaXRoIGN1c3RvbSBvYmplY3QgYW5kIG1hcHBpbmcge0BsaW5rIExpbmVHZW9tZXRyeX06XG4gKiBgYGBqYXZhc2NyaXB0XG4gKiAvLyBOb3RlOiB0aGlzIGlzIG5vdCByZWNvbW1lbmRlZCBidXQgcG9zc2libGUuXG4gKiAvLyBVc2luZyB0aGlzIHRlY2huaXF1ZSwgZWFjaCBvYmplY3Qgd291bGQgaGF2ZSBpdCdzIG93biBxdEluZGV4IG1ldGhvZC5cbiAqIC8vIFJhdGhlciBhZGQgcXRJbmRleCB0byB5b3VyIHByb3RvdHlwZSwgZS5nLiBieSB1c2luZyBjbGFzc2VzIGxpa2Ugc2hvd24gYWJvdmUuXG4gKiBjb25zdCBwbGF5ZXIgPSB7XG4gKiAgIG5hbWU6ICdKYW5lJyxcbiAqICAgaGVhbHRoOiAxMDAsXG4gKiAgIHN0YXJ0OiBbMTAsIDIwXSxcbiAqICAgZW5kOiBbMzAsIDQwXSxcbiAqICAgcXRJbmRleDogZnVuY3Rpb24obm9kZSkge1xuICogICAgIHJldHVybiBMaW5lLnByb3RvdHlwZS5xdEluZGV4LmNhbGwoe1xuICogICAgICAgeDE6IHRoaXMuc3RhcnRbMF0sXG4gKiAgICAgICB5MTogdGhpcy5zdGFydFsxXSxcbiAqICAgICAgIHgyOiB0aGlzLmVuZFswXSxcbiAqICAgICAgIHkyOiB0aGlzLmVuZFsxXSxcbiAqICAgICB9LCBub2RlKTtcbiAqICAgfSxcbiAqIH0pO1xuICogYGBgXG4gKi9cbmNsYXNzIExpbmUge1xuICAgIC8qKlxuICAgICAqIExpbmUgQ29uc3RydWN0b3JcbiAgICAgKiBAcGFyYW0gcHJvcHMgLSBMaW5lIHByb3BlcnRpZXNcbiAgICAgKiBAdHlwZVBhcmFtIEN1c3RvbURhdGFUeXBlIC0gVHlwZSBvZiB0aGUgY3VzdG9tIGRhdGEgcHJvcGVydHkgKG9wdGlvbmFsLCBpbmZlcnJlZCBhdXRvbWF0aWNhbGx5KS5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgICAgICB0aGlzLngxID0gcHJvcHMueDE7XG4gICAgICAgIHRoaXMueTEgPSBwcm9wcy55MTtcbiAgICAgICAgdGhpcy54MiA9IHByb3BzLngyO1xuICAgICAgICB0aGlzLnkyID0gcHJvcHMueTI7XG4gICAgICAgIHRoaXMuZGF0YSA9IHByb3BzLmRhdGE7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIERldGVybWluZSB3aGljaCBxdWFkcmFudCB0aGlzIGxpbmUgYmVsb25ncyB0by5cbiAgICAgKiBAYmV0YVxuICAgICAqIEBwYXJhbSBub2RlIC0gUXVhZHRyZWUgbm9kZSB0byBiZSBjaGVja2VkXG4gICAgICogQHJldHVybnMgQXJyYXkgY29udGFpbmluZyBpbmRleGVzIG9mIGludGVyc2VjdGluZyBzdWJub2RlcyAoMC0zID0gdG9wLXJpZ2h0LCB0b3AtbGVmdCwgYm90dG9tLWxlZnQsIGJvdHRvbS1yaWdodClcbiAgICAgKi9cbiAgICBxdEluZGV4KG5vZGUpIHtcbiAgICAgICAgY29uc3QgaW5kZXhlcyA9IFtdLCB3MiA9IG5vZGUud2lkdGggLyAyLCBoMiA9IG5vZGUuaGVpZ2h0IC8gMiwgeDIgPSBub2RlLnggKyB3MiwgeTIgPSBub2RlLnkgKyBoMjtcbiAgICAgICAgLy9hbiBhcnJheSBvZiBub2RlIG9yaWdpbnMgd2hlcmUgdGhlIGFycmF5IGluZGV4IGVxdWFscyB0aGUgbm9kZSBpbmRleFxuICAgICAgICBjb25zdCBub2RlcyA9IFtcbiAgICAgICAgICAgIFt4Miwgbm9kZS55XSxcbiAgICAgICAgICAgIFtub2RlLngsIG5vZGUueV0sXG4gICAgICAgICAgICBbbm9kZS54LCB5Ml0sXG4gICAgICAgICAgICBbeDIsIHkyXSxcbiAgICAgICAgXTtcbiAgICAgICAgLy90ZXN0IGFsbCBub2RlcyBmb3IgbGluZSBpbnRlcnNlY3Rpb25zXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbm9kZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChMaW5lLmludGVyc2VjdFJlY3QodGhpcy54MSwgdGhpcy55MSwgdGhpcy54MiwgdGhpcy55Miwgbm9kZXNbaV1bMF0sIG5vZGVzW2ldWzFdLCBub2Rlc1tpXVswXSArIHcyLCBub2Rlc1tpXVsxXSArIGgyKSkge1xuICAgICAgICAgICAgICAgIGluZGV4ZXMucHVzaChpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gaW5kZXhlcztcbiAgICB9XG4gICAgLyoqXG4gICAgICogY2hlY2sgaWYgYSBsaW5lIHNlZ21lbnQgKHRoZSBmaXJzdCA0IHBhcmFtZXRlcnMpIGludGVyc2VjdHMgYW4gYXhpcyBhbGlnbmVkIHJlY3RhbmdsZSAodGhlIGxhc3QgNCBwYXJhbWV0ZXJzKVxuICAgICAqIEBiZXRhXG4gICAgICpcbiAgICAgKiBAcmVtYXJrc1xuICAgICAqIFRoZXJlIGlzIGEgYnVnIHdoZXJlIGRldGVjdGlvbiBmYWlscyBvbiBjb3JuZXIgaW50ZXJzZWN0aW9uc1xuICAgICAqIHdoZW4gdGhlIGxpbmUgZW50ZXJzL2V4aXRzIHRoZSBub2RlIGV4YWN0bHkgYXQgY29ybmVycyAoNDXCsClcbiAgICAgKiB7QGxpbmsgaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9hLzE4MjkyOTY0Lzg2MDIwNX1cbiAgICAgKlxuICAgICAqIEBwYXJhbSB4MSAtIGxpbmUgc3RhcnQgWFxuICAgICAqIEBwYXJhbSB5MSAtIGxpbmUgc3RhcnQgWVxuICAgICAqIEBwYXJhbSB4MiAtIGxpbmUgZW5kIFhcbiAgICAgKiBAcGFyYW0geTIgLSBsaW5lIGVuZCBZXG4gICAgICogQHBhcmFtIG1pblggLSByZWN0YW5nbGUgc3RhcnQgWFxuICAgICAqIEBwYXJhbSBtaW5ZIC0gcmVjdGFuZ2xlIHN0YXJ0IFlcbiAgICAgKiBAcGFyYW0gbWF4WCAtIHJlY3RhbmdsZSBlbmQgWFxuICAgICAqIEBwYXJhbSBtYXhZIC0gcmVjdGFuZ2xlIGVuZCBZXG4gICAgICogQHJldHVybnMgdHJ1ZSBpZiB0aGUgbGluZSBzZWdtZW50IGludGVyc2VjdHMgdGhlIGF4aXMgYWxpZ25lZCByZWN0YW5nbGVcbiAgICAgKi9cbiAgICBzdGF0aWMgaW50ZXJzZWN0UmVjdCh4MSwgeTEsIHgyLCB5MiwgbWluWCwgbWluWSwgbWF4WCwgbWF4WSkge1xuICAgICAgICAvLyBDb21wbGV0ZWx5IG91dHNpZGVcbiAgICAgICAgaWYgKCh4MSA8PSBtaW5YICYmIHgyIDw9IG1pblgpIHx8ICh5MSA8PSBtaW5ZICYmIHkyIDw9IG1pblkpIHx8ICh4MSA+PSBtYXhYICYmIHgyID49IG1heFgpIHx8ICh5MSA+PSBtYXhZICYmIHkyID49IG1heFkpKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAvLyBTaW5nbGUgcG9pbnQgaW5zaWRlXG4gICAgICAgIGlmICgoeDEgPj0gbWluWCAmJiB4MSA8PSBtYXhYICYmIHkxID49IG1pblkgJiYgeTEgPD0gbWF4WSkgfHwgKHgyID49IG1pblggJiYgeDIgPD0gbWF4WCAmJiB5MiA+PSBtaW5ZICYmIHkyIDw9IG1heFkpKVxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIGNvbnN0IG0gPSAoeTIgLSB5MSkgLyAoeDIgLSB4MSk7XG4gICAgICAgIGxldCB5ID0gbSAqIChtaW5YIC0geDEpICsgeTE7XG4gICAgICAgIGlmICh5ID4gbWluWSAmJiB5IDwgbWF4WSlcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB5ID0gbSAqIChtYXhYIC0geDEpICsgeTE7XG4gICAgICAgIGlmICh5ID4gbWluWSAmJiB5IDwgbWF4WSlcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICBsZXQgeCA9IChtaW5ZIC0geTEpIC8gbSArIHgxO1xuICAgICAgICBpZiAoeCA+IG1pblggJiYgeCA8IG1heFgpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgeCA9IChtYXhZIC0geTEpIC8gbSArIHgxO1xuICAgICAgICBpZiAoeCA+IG1pblggJiYgeCA8IG1heFgpXG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cblxuZXhwb3J0IHsgQ2lyY2xlLCBMaW5lLCBRdWFkdHJlZSwgUmVjdGFuZ2xlIH07XG4iLCJpbXBvcnQgeyBRdWFkdHJlZSwgQ2lyY2xlLCBOb2RlR2VvbWV0cnkgfSBmcm9tIFwiQHRpbW9oYXVzbWFubi9xdWFkdHJlZS10c1wiO1xuaW1wb3J0IHsgbnVtYmVyIH0gZnJvbSBcInlhcmdzXCI7XG5cbmV4cG9ydCBjbGFzcyBEcm9wbGV0IHtcbiAgICAvLyBidWJibGUgcG9zaXRpb25cbiAgICB4OiBudW1iZXI7XG4gICAgeTogbnVtYmVyO1xuICAgIC8vIFRoZSBkcm9wbGV0IGFyZWEuXG4gICAgYXJlYTogbnVtYmVyO1xuICAgIGlkOiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3Rvcih4OiBudW1iZXIsIHk6IG51bWJlciwgYXJlYTogbnVtYmVyLCBpZDogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMueCA9IHg7XG4gICAgICAgIHRoaXMueSA9IHk7XG4gICAgICAgIHRoaXMuYXJlYSA9IGFyZWE7XG4gICAgICAgIHRoaXMuaWQgPSBpZDtcbiAgICB9XG5cbiAgICBhYnNvcmIoZDogRHJvcGxldCkge1xuICAgICAgICBjb25zdCBuZXdBcmVhID0gdGhpcy5hcmVhICsgZC5hcmVhO1xuICAgICAgICAvLyBUaGUgbmV3IHBvc2l0aW9uIGlzIHRoZSB3ZWlnaHRlZCBzdW0uXG4gICAgICAgIHRoaXMueCA9ICh0aGlzLnggKiB0aGlzLmFyZWEgKyBkLnggKiBkLmFyZWEpIC8gbmV3QXJlYTtcbiAgICAgICAgdGhpcy55ID0gKHRoaXMueSAqIHRoaXMuYXJlYSArIGQueSAqIGQuYXJlYSkgLyBuZXdBcmVhO1xuICAgICAgICB0aGlzLmFyZWEgPSBuZXdBcmVhO1xuICAgIH1cblxuICAgIHJhZGl1cygpOiBudW1iZXIge1xuICAgICAgICAvLyBBID0gcGkqcl4yXG4gICAgICAgIHJldHVybiBNYXRoLnNxcnQodGhpcy5hcmVhIC8gTWF0aC5QSSk7XG4gICAgfVxuXG4gICAgLy8gVG8gYmUgYWJsZSB0byB1c2UgRHJvcGxldCBpcyBhIHF1YWR0cmVlZS5cbiAgICBxdEluZGV4KG5vZGU6IE5vZGVHZW9tZXRyeSkge1xuICAgICAgICByZXR1cm4gQ2lyY2xlLnByb3RvdHlwZS5xdEluZGV4LmNhbGwoe1xuICAgICAgICAgICAgeDogdGhpcy54LFxuICAgICAgICAgICAgeTogdGhpcy55LFxuICAgICAgICAgICAgcjogdGhpcy5yYWRpdXMoKSxcbiAgICAgICAgfSwgbm9kZSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBkaXN0YW5jZShsOiBEcm9wbGV0LCByOiBEcm9wbGV0KTogbnVtYmVyIHtcbiAgICByZXR1cm4gTWF0aC5zcXJ0KChsLnggLSByLngpICogKGwueCAtIHIueCkgKyAobC55IC0gci55KSAqIChsLnkgLSByLnkpKTtcbn1cblxuZXhwb3J0IGNsYXNzIFNpbXVsYXRpb24ge1xuICAgIHByaXZhdGUgd2lkdGg6IG51bWJlcjtcbiAgICBwcml2YXRlIGhlaWdodDogbnVtYmVyO1xuICAgIHByaXZhdGUgbl9zYW1wbGVzOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBzYW1wbGVfZHJvcGxldF9hcmVhOiBudW1iZXI7XG4gICAgcXVhZHRyZWU6IFF1YWR0cmVlPERyb3BsZXQ+O1xuICAgIHByaXZhdGUgY3VyX2lkOiBudW1iZXI7XG4gICAgbGFyZ2VzdF9kcm9wbGV0X2FyZWE6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKHdpZHRoOiBudW1iZXIsIGhlaWdodDogbnVtYmVyLCBuX3NhbXBsZXM6IG51bWJlciwgc2FtcGxlX2Ryb3BsZXRfYXJlYTogbnVtYmVyKSB7XG4gICAgICAgIHRoaXMud2lkdGggPSB3aWR0aDtcbiAgICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7XG4gICAgICAgIHRoaXMubl9zYW1wbGVzID0gbl9zYW1wbGVzO1xuICAgICAgICB0aGlzLnNhbXBsZV9kcm9wbGV0X2FyZWEgPSBzYW1wbGVfZHJvcGxldF9hcmVhO1xuICAgICAgICB0aGlzLmN1cl9pZCA9IDA7XG4gICAgICAgIHRoaXMucXVhZHRyZWUgPSBuZXcgUXVhZHRyZWU8RHJvcGxldD4oe1xuICAgICAgICAgICAgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCxcbiAgICAgICAgICAgIG1heE9iamVjdHM6IDQsIG1heExldmVsczogNixcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMubGFyZ2VzdF9kcm9wbGV0X2FyZWEgPSAwO1xuICAgIH1cblxuICAgIGFkZERyb3BsZXQoZDogRHJvcGxldCkge1xuICAgICAgICB3aGlsZSAodHJ1ZSkge1xuICAgICAgICAgICAgLy8gRmluZCB0aGUgY2xvc2VzdCBkcm9wbGV0cy5cbiAgICAgICAgICAgIGxldCBuZWlnaGJvdXJzID0gdGhpcy5xdWFkdHJlZS5yZXRyaWV2ZShkKTtcblxuICAgICAgICAgICAgbGV0IG5leHQgPSBudWxsO1xuICAgICAgICAgICAgZm9yIChjb25zdCBuZWlnaGJvdXIgb2YgbmVpZ2hib3Vycykge1xuICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGBnb3QgbmVpZ2hib3VyICR7bmVpZ2hib3VyLmlkfSBkaXN0PSR7ZGlzdH0gdD0keyhkLnJhZGl1cygpICsgbmVpZ2hib3VyLnJhZGl1cygpKX1gKTtcbiAgICAgICAgICAgICAgICBpZiAoZGlzdGFuY2UoZCwgbmVpZ2hib3VyKSA8PSAoZC5yYWRpdXMoKSArIG5laWdoYm91ci5yYWRpdXMoKSkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gQ29hbGVzY2UuXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucXVhZHRyZWUucmVtb3ZlKG5laWdoYm91ciwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIG5laWdoYm91ci5hYnNvcmIoZCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIE5vdyB0cnkgdG8gaW5zZXJ0IGJhY2sgdGhlIG1lcmdlZCBidWJibGUsIHdoaWNoIG1pZ2h0IHRyaWdnZXIgZnVydGhlciBtZXJnZXMuXG4gICAgICAgICAgICAgICAgICAgIG5leHQgPSBuZWlnaGJvdXI7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghbmV4dCkgYnJlYWs7IC8vIG5vIG5laWdoYm91cnMgdG8gbWVyZ2UgaW50by5cbiAgICAgICAgICAgIGQgPSBuZXh0O1xuICAgICAgICB9XG4gICAgICAgIC8vIFRoZSBkcm9wbGV0IGRvZXMgbm90IGludGVyc2VjdCBhbnkgZXhpc3RpbmcgZHJvcGxldC5cbiAgICAgICAgaWYgKGQuYXJlYSA+IHRoaXMubGFyZ2VzdF9kcm9wbGV0X2FyZWEpIHtcbiAgICAgICAgICAgIHRoaXMubGFyZ2VzdF9kcm9wbGV0X2FyZWEgPSBkLmFyZWE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5xdWFkdHJlZS5pbnNlcnQoZCk7XG4gICAgfVxuXG4gICAgLy8gUmV0dXJucyB0aGUgZHJvcGxldHMsIGluIG5vIHBhcnRpY3VsYXIgb3JkZXIuXG4gICAgZHJvcGxldHMoKTogQXJyYXk8RHJvcGxldD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5xdWFkdHJlZS5yZXRyaWV2ZShcbiAgICAgICAgICAgIG5ldyBEcm9wbGV0KHRoaXMud2lkdGggLyAyLCB0aGlzLmhlaWdodCAvIDIsIDEwMDAwMDAwMDAwLCAwKSk7ICAvLyBDYW4gd2UgZG8gYmV0dGVyID9cbiAgICB9XG5cbiAgICBzdGVwKCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubl9zYW1wbGVzOyArK2kpIHtcbiAgICAgICAgICAgIHRoaXMuYWRkRHJvcGxldChuZXcgRHJvcGxldChcbiAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpICogdGhpcy53aWR0aCxcbiAgICAgICAgICAgICAgICBNYXRoLnJhbmRvbSgpICogdGhpcy5oZWlnaHQsXG4gICAgICAgICAgICAgICAgdGhpcy5zYW1wbGVfZHJvcGxldF9hcmVhLFxuICAgICAgICAgICAgICAgICsrdGhpcy5jdXJfaWQpKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGRyYXcoY3R4OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQpIHtcbiAgICAgICAgY29uc3QgZHJvcGxldHMgPSB0aGlzLmRyb3BsZXRzKCk7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKGBkcmF3aW5nICR7ZHJvcGxldHMubGVuZ3RofSBwb2ludHNgKTtcbiAgICAgICAgZm9yIChjb25zdCBkcm9wbGV0IG9mIGRyb3BsZXRzKSB7XG4gICAgICAgICAgICBjdHguZmlsbFN0eWxlID0gXCJyZ2IoMjAwIDAgMClcIjtcbiAgICAgICAgICAgIGN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgIGN0eC5hcmMoZHJvcGxldC54LCBkcm9wbGV0LnksIGRyb3BsZXQucmFkaXVzKCksIDAsIE1hdGguUEkgKiAyKTtcbiAgICAgICAgICAgIGN0eC5maWxsKCk7XG4gICAgICAgIH1cbiAgICB9XG5cbn1cbiIsImltcG9ydCB7IFNpbXVsYXRpb24gfSBmcm9tICcuL3NpbXVsYXRpb24nXG5cbmFzeW5jIGZ1bmN0aW9uIHJ1bigpIHtcbiAgICBjb25zdCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImNhbnZhc1wiKSBhcyBIVE1MQ2FudmFzRWxlbWVudDtcbiAgICBjb25zdCBjdHggPSBjYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgIGNvbnN0IHNpbXVsYXRpb24gPSBuZXcgU2ltdWxhdGlvbihjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQsIDUwMCwgMjUwKTtcblxuICAgIGlmICghY3R4KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcInVuc3VwcG9ydGVkIDJkIGNhbnZhc1wiKTtcbiAgICB9XG4gICAgd2hpbGUgKHNpbXVsYXRpb24ubGFyZ2VzdF9kcm9wbGV0X2FyZWEgPCBjYW52YXMud2lkdGggKiBjYW52YXMuaGVpZ2h0IC8gNCkge1xuICAgICAgICBzaW11bGF0aW9uLnN0ZXAoKTtcbiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpO1xuICAgICAgICBzaW11bGF0aW9uLmRyYXcoY3R4KTtcbiAgICAgICAgaWYgKHNpbXVsYXRpb24uZHJvcGxldHMubGVuZ3RoID09IDEpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMzApKTsgIC8vIFdhaXQuXG4gICAgfVxufVxuXG53aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcihcImxvYWRcIiwgcnVuKTsiXSwibmFtZXMiOlsiUXVhZHRyZWUiLCJjb25zdHJ1Y3RvciIsInByb3BzIiwibGV2ZWwiLCJ0aGlzIiwiYm91bmRzIiwieCIsInkiLCJ3aWR0aCIsImhlaWdodCIsIm1heE9iamVjdHMiLCJtYXhMZXZlbHMiLCJvYmplY3RzIiwibm9kZXMiLCJnZXRJbmRleCIsIm9iaiIsInF0SW5kZXgiLCJzcGxpdCIsImNvb3JkcyIsImkiLCJpbnNlcnQiLCJsZW5ndGgiLCJpbmRleGVzIiwicHVzaCIsImsiLCJyZXRyaWV2ZSIsInJldHVybk9iamVjdHMiLCJjb25jYXQiLCJBcnJheSIsImZyb20iLCJTZXQiLCJyZW1vdmUiLCJmYXN0IiwiaW5kZXhPZiIsInNwbGljZSIsImpvaW4iLCJ1cGRhdGUiLCJhbGxPYmplY3RzIiwiYmxhIiwidW5pcXVlT2JqZWN0cyIsImNsZWFyIiwiQ2lyY2xlIiwiciIsImRhdGEiLCJub2RlIiwidzIiLCJoMiIsIngyIiwieTIiLCJpbnRlcnNlY3RSZWN0IiwibWluWCIsIm1pblkiLCJtYXhYIiwibWF4WSIsImRlbHRhWCIsIk1hdGgiLCJtYXgiLCJtaW4iLCJkZWx0YVkiLCJEcm9wbGV0IiwiYXJlYSIsImlkIiwiYWJzb3JiIiwiZCIsIm5ld0FyZWEiLCJyYWRpdXMiLCJzcXJ0IiwiUEkiLCJwcm90b3R5cGUiLCJjYWxsIiwiZGlzdGFuY2UiLCJsIiwiU2ltdWxhdGlvbiIsIm5fc2FtcGxlcyIsInNhbXBsZV9kcm9wbGV0X2FyZWEiLCJjdXJfaWQiLCJxdWFkdHJlZSIsImxhcmdlc3RfZHJvcGxldF9hcmVhIiwiYWRkRHJvcGxldCIsIm5laWdoYm91cnMiLCJuZXh0IiwibmVpZ2hib3VyIiwiZHJvcGxldHMiLCJzdGVwIiwicmFuZG9tIiwiZHJhdyIsImN0eCIsImRyb3BsZXQiLCJmaWxsU3R5bGUiLCJiZWdpblBhdGgiLCJhcmMiLCJmaWxsIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImNhbnZhcyIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJnZXRDb250ZXh0Iiwic2ltdWxhdGlvbiIsIkVycm9yIiwiY2xlYXJSZWN0IiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0Il0sInNvdXJjZVJvb3QiOiIifQ==